<form [formGroup]="checkoutForm" (ngSubmit)="submitForm(checkoutForm)">
  <!-- Page content -->
  <section class="container pt-3 pt-md-4 pb-3 pb-sm-4 pb-lg-5 mb-4">
    <div class="row">
      <!-- Checkout content -->
      <div class="col-lg-8 pr-lg-6">
        <div
          class="d-flex align-items-center justify-content-between pb-2 mb-4"
        >
          <h1 class="mb-0">Verificar tu compra</h1>
          <a href="shop-catalog.html"><strong>Seguir comprando</strong></a>
        </div>

        <!-- Alert -->
        <div class="alert alert-info mb-4" role="alert">
          <div class="media align-items-center">
            <i class="cxi-profile lead mr-3"></i>
            <div class="media-body">
              Already have an account?&nbsp;&nbsp;<a
                href="#modal-signin"
                class="alert-link"
                data-toggle="modal"
                data-view="#modal-signin-view"
                >Sign in</a
              >&nbsp;&nbsp;for faster checkout experience.
            </div>
          </div>
        </div>

        <hr class="border-top-0 border-bottom pt-2 mb-4" />

        <!-- Order review -->
        <h2 class="h4 mb-4">1. Revisión del pedido</h2>
        <ng-container *ngIf="cart">
          <div class="bg-secondary rounded mb-5">
            <ng-container *ngFor="let p of cart.products; let i = index">
              <div class="media px-2 px-sm-4 py-4 border-bottom">
                <a href="shop-single.html" style="min-width: 80px">
                  <img
                    [src]="getImg(p.product.cover)"
                    width="80"
                    [alt]="p.product.cover"
                  />
                </a>
                <div class="media-body w-100 pl-3">
                  <div class="d-sm-flex">
                    <div class="pr-sm-3 w-100" style="max-width: 16rem">
                      <h3 class="font-size-sm mb-3">
                        <a
                          href="shop-single.html"
                          class="nav-link font-weight-bold"
                          >{{ p.product.name }}</a
                        >
                      </h3>
                      <ul class="list-unstyled font-size-xs mt-n2 mb-2">
                        <li class="mb-0">
                          <span class="text-muted">Color:</span> Pink
                        </li>
                        <li class="mb-0">
                          <span class="text-muted">Size:</span> S
                        </li>
                      </ul>
                    </div>
                    <div class="d-flex pr-sm-3">
                      <input
                        type="number"
                        class="form-control form-control-sm bg-light mr-3"
                        style="width: 4.5rem"
                        #amountInput
                        [value]="amounts[i]"
                        (change)="
                          changeAmount(amountInput.value, p.product.price, i)
                        "
                      />
                      <div class="text-nowrap pt-2">
                        <strong class="text-danger">${{ substotal[i] }}</strong>
                        <!-- <s class="font-size-xs text-muted">$31.00</s> -->
                      </div>
                    </div>
                    <div
                      class="
                        d-flex
                        align-items-center
                        flex-sm-column
                        text-sm-center
                        ml-sm-auto
                        pt-3 pt-sm-0
                      "
                    >
                      <button
                        class="btn btn-outline-primary btn-sm mr-2 mr-sm-0"
                      >
                        Delete
                      </button>
                      <button
                        class="
                          btn btn-link btn-sm
                          text-decoration-none
                          pt-0 pt-sm-2
                          px-0
                          pb-0
                          mt-0 mt-sm-1
                        "
                      >
                        Move to
                        <i class="cxi-heart ml-1"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </ng-container>

            <div class="px-3 px-sm-4 py-4 text-right">
              <span class="text-muted"
                >Subtotal:<strong class="text-dark font-size-lg ml-2"
                  >${{ calculateSubTotal() }}</strong
                ></span
              >
            </div>
          </div>
        </ng-container>

        <!-- Address -->
        <h2 class="h4 mb-4">2. Dirección de envío y facturación</h2>
        <div class="row pb-3">
          <div class="col-sm-6 form-group">
            <label for="ch-fn">Nombre</label>
            <input
              type="text"
              name="nameAddressCheck"
              formControlName="nameAddressCheck"
              class="form-control form-control-lg"
              id="ch-fn"
              placeholder="Tu nombre"
            />
          </div>
          <div class="col-sm-6 form-group">
            <label for="ch-ln">Apellidos</label>
            <input
              type="text"
              class="form-control form-control-lg"
              id="ch-ln"
              name="lastnameAddressCheck"
              formControlName="lastnameAddressCheck"
              placeholder="Tu apellido"
            />
          </div>
          <div class="col-sm-6 form-group">
            <label for="ch-email">Correo</label>
            <input
              type="email"
              name="emailAddressCheck"
              formControlName="emailAddressCheck"
              class="form-control form-control-lg"
              id="ch-email"
              placeholder="Tu correo"
            />
          </div>
          <div class="col-sm-6 form-group">
            <label for="ch-phone">Telefono</label>
            <input
              type="text"
              class="form-control form-control-lg"
              id="ch-phone"
              name="phoneAddressCheck"
              formControlName="phoneAddressCheck"
              placeholder="Tu numero de telefono"
            />
          </div>
          <div class="col-sm-6 form-group">
            <label for="ch-country">Pais</label>
            <select
              name="countryAddressCheck"
              formControlName="countryAddressCheck"
              id="ch-country"
              class="custom-select custom-select-lg"
            >
              <option value="" disabled selected>Elige un país</option>
              <option [value]="'Peru'">Peru</option>
            </select>
          </div>
          <div class="col-sm-6 form-group">
            <label for="ch-city">Ciudad</label>
            <select
              name="cityAddressCheck"
              formControlName="cityAddressCheck"
              id="ch-city"
              class="custom-select custom-select-lg"
            >
              <option value="" disabled selected>Elige ciudad</option>
              <ng-container *ngFor="let city of cities$ | async">
                <option [value]="city.name">{{ city.name }}</option>
              </ng-container>
            </select>
          </div>
          <div class="col-sm-6 form-group">
            <label for="ch-address">Dirección</label>
            <input
              name="addressCheck"
              formControlName="addressCheck"
              type="text"
              class="form-control form-control-lg"
              id="ch-address"
              placeholder="Calle, departamento..."
            />
          </div>
          <div class="col-sm-6 form-group">
            <label for="ch-zip">Codigo ZIP</label>
            <input
              type="text"
              class="form-control form-control-lg"
              id="ch-zip"
              name="zipAddressCheck"
              formControlName="zipAddressCheck"
              placeholder="Codigo ZIP"
            />
          </div>

          <div class="col-12 form-group">
            <div class="custom-control custom-checkbox">
              <input
                type="checkbox"
                class="custom-control-input"
                id="same-details"
                checked
              />
              <label for="same-details" class="custom-control-label">
                Los detalles de facturación y envío son los mismos</label
              >
            </div>
          </div>
        </div>

        <hr class="mb-4 pb-2" />

        <!-- Shipping -->
        <h2 class="h4 mb-4">3. Metodos de envío</h2>
        <ng-container *ngFor="let del of delivery$ | async">
          <div class="custom-control custom-radio mb-3">
            <input
              name="deliveryAddressCheck"
              formControlName="deliveryAddressCheck"
              type="radio"
              class="custom-control-input"
              id="courier"
              [value]="del.title"
              [defaultChecked]="delivery[0]"
            />
            <label
              for="courier"
              class="custom-control-label d-flex align-items-center"
            >
              <span>
                <strong class="d-block">{{ del.title }}</strong>
                <span class="text-muted font-size-sm"
                  >Tiempo estimado: {{ del.timeMax }}</span
                >
              </span>
              <span class="ml-auto">${{ del.price }}</span>
            </label>
          </div>
        </ng-container>

        <hr class="border-top-0 border-bottom pt-4 mb-4" />

        <!-- Payment -->
        <h2 class="h4 pt-2 mb-4">4. Payment Method</h2>
        <div class="row pb-4">
          <div class="col-lg-7">
            <div class="accordion-alt" id="payment-methods">
              <!-- Card: Credit card -->
              <div class="card mb-3 px-4 py-3 border rounded box-shadow-sm">
                <div class="card-header py-2">
                  <div
                    class="accordion-heading custom-control custom-radio"
                    data-toggle="collapse"
                    data-target="#cc-card"
                  >
                    <input
                      type="radio"
                      class="custom-control-input"
                      id="cc"
                      name="payment"
                      checked
                    />
                    <label
                      for="cc"
                      class="custom-control-label d-flex align-items-center"
                    >
                      <strong class="d-block mr-3">Credit card</strong>
                      <img
                        src="assets/img/cards.png"
                        width="108"
                        alt="Credit cards"
                      />
                    </label>
                  </div>
                </div>
                <div
                  class="collapse show"
                  id="cc-card"
                  data-parent="#payment-methods"
                >
                  <div class="card-body pt-3 pb-0">
                    <div class="form-group mb-3">
                      <label for="cc-number">Card number</label>
                      <input
                        type="text"
                        id="cc-number"
                        class="form-control form-control-lg"
                        data-format="card"
                        placeholder="0000 0000 0000 0000"
                      />
                    </div>
                    <div class="d-flex">
                      <div class="form-group mb-3 mr-3">
                        <label for="cc-exp-date">Expiry date</label>
                        <input
                          type="text"
                          id="cc-exp-date"
                          class="form-control form-control-lg"
                          data-format="date"
                          placeholder="mm/yy"
                        />
                      </div>
                      <div class="form-group mb-3">
                        <label for="cc-cvc">CVC</label>
                        <input
                          type="text"
                          id="cc-cvc"
                          class="form-control form-control-lg"
                          data-format="cvc"
                          placeholder="000"
                        />
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Card: PayPal -->
              <div class="card mb-3 px-4 py-3 border rounded box-shadow-sm">
                <div class="card-header py-2">
                  <div
                    class="accordion-heading custom-control custom-radio"
                    data-toggle="collapse"
                    data-target="#paypal-card"
                  >
                    <input
                      type="radio"
                      class="custom-control-input"
                      id="paypal"
                      name="payment"
                    />
                    <label
                      for="paypal"
                      class="custom-control-label d-flex align-items-center"
                    >
                      <strong class="d-block mr-3">PayPal</strong>
                      <img
                        src="assets/img/paypal-badge.png"
                        width="48"
                        alt="PayPal"
                      />
                    </label>
                  </div>
                </div>
                <div
                  class="collapse"
                  id="paypal-card"
                  data-parent="#payment-methods"
                >
                  <div class="card-body pt-3 pb-0" #paypalButton></div>
                </div>
              </div>

              <!-- Card: Cash -->
              <div class="card mb-3 px-4 py-3 border rounded box-shadow-sm">
                <div class="card-header py-2">
                  <div
                    class="accordion-heading custom-control custom-radio"
                    data-toggle="collapse"
                    data-target="#cash-card"
                  >
                    <input
                      type="radio"
                      class="custom-control-input"
                      id="cash"
                      name="payment"
                    />
                    <label for="cash" class="custom-control-label">
                      <strong class="d-block mr-3">Cash on delivery</strong>
                    </label>
                  </div>
                </div>
                <div
                  class="collapse"
                  id="cash-card"
                  data-parent="#payment-methods"
                >
                  <div class="card-body pt-3 pb-0">
                    <p class="mb-2 text-muted">
                      You have selected to pay with cash upon delivery.
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <hr class="mb-4 pb-2" />

        <!-- Additional info -->
        <h2 class="h4 mb-4">5. Additional Information (optional)</h2>
        <div class="form-group">
          <label for="ch-notes">Order notes</label>
          <textarea
            id="ch-notes"
            class="form-control form-control-lg"
            rows="5"
            name="notesAddressCheck"
            formControlName="notesAddressCheck"
            placeholder="Notes about your order, e.g. special noted for delivery."
          ></textarea>
        </div>
      </div>

      <!-- Order totals (sticky sidebar) -->
      <!-- For more sticky sidebar options visit https://abouolia.github.io/sticky-sidebar/#options -->
      <aside class="col-lg-4">
        <div class="sidebar-sticky">
          <div class="sidebar-sticky-inner">
            <div class="form-group">
              <label for="promo-code">Apply a promo code</label>
              <div class="input-group input-group-lg">
                <input
                  type="text"
                  id="promo-code"
                  class="form-control"
                  placeholder="Enter promo code"
                />
                <div class="input-group-append">
                  <button type="button" class="btn btn-primary">
                    &nbsp;&nbsp;Apply&nbsp;&nbsp;
                  </button>
                </div>
              </div>
            </div>
            <div class="bg-secondary rounded mb-4">
              <div class="border-bottom p-4">
                <h2 class="h4 mb-0">Order totals</h2>
              </div>
              <ul class="list-unstyled border-bottom mb-0 p-4">
                <li class="d-flex justify-content-between mb-2">
                  <span class="font-weight-bold">Subtotal:</span>
                  <span class="font-weight-bold"
                    >${{ calculateSubTotal() }}</span
                  >
                </li>
                <li class="d-flex justify-content-between mb-2">
                  <span>Shipping costs:</span>
                  <span>${{ igv }}</span>
                </li>
                <li class="d-flex justify-content-between mb-2">
                  <span>Discount:</span>
                  <span>&mdash;</span>
                </li>
                <li class="d-flex justify-content-between">
                  <span>Estimated sales tax:</span>
                  <span>${{ valueCC.deliveryAddressCheck() }}</span>
                </li>
              </ul>
              <div class="d-flex justify-content-between p-4">
                <span class="h5 mb-0">Order total:</span>
                <span class="h5 mb-0">${{ calculateTotal() }}</span>
              </div>
            </div>
            <button type="submit" class="btn btn-primary btn-lg btn-block">
              Complete order
            </button>
          </div>
        </div>
      </aside>
    </div>
  </section>
</form>
